
## LSTM
### Structure 
Tied = False 

| emsize | nhid | nlayers | drop out  | clip    |param_size  | Best loss/PPL    |
| ------ | ---- | ------- | --------- | ------- | ---------  |-------------     |
| 200    | 200  |   2     |  0.2      | 0.25    | 11.75 M    |    4.96 / 141.95 |
| 200    | 400  |   2     |  0.2      | 0.25    | 18.90 M    |    4.85 / 127.99 |
| 200    | 600  |   2     |  0.2      | 0.25    | 27.01 M    |    4.82 / 124.48 |
| 400    | 200  |   2     |  0.2      | 0.25    | 17.46 M    |    4.96 / 141.61 |
| 400    | 400  |   2     |  0.2      | 0.25    | 24.76 M    |    4.85 / 128.17 |
| 400    | 600  |   2     |  0.2      | 0.25    | 33.03 M    |    4.82 / 124.17 |
| 600    | 200  |   2     |  0.2      | 0.25    | 23.16 M    |    4.96 / 142.29 |
| 600    | 400  |   2     |  0.2      | 0.25    | 30.62 M    |    4.85 / 128.14 |
| 600    | 600  |   2     |  0.2      | 0.25    | 39.05 M    |    4.82 / 124.45 |


Tied = True
| emsize | nhid | nlayers | drop out  | clip    |param_size  | Best Test loss/PPL |
| ------ | ---- | ------- | --------- | ------- | ---------  |-------------       |
| 200    | 200  |   2     |  0.15     | 0.10    |  6.21 M    |   4.93 / 138.06    |
| 200    | 200  |   2     |  0.15     | 0.25    |  6.21 M    |   4.95 / 141.01   |
| 200    | 200  |   2     |  0.15     | 0.50    |  6.21 M    |   4.95 / 141.10    |
| 200    | 200  |   2     |  0.25     | 0.10    |  6.21 M    |   4.95 / 140.70    |
| 200    | 200  |   2     |  0.25     | 0.25    |  6.21 M    |   4.98 / 145.70   |
| 200    | 200  |   2     |  0.25     | 0.50    |  6.21 M    |   4.98 / 145.02    |
| 200    | 200  |   2     |  0.35     | 0.10    |  6.21 M    |   4.99 / 147.52    |
| 200    | 200  |   2     |  0.35     | 0.25    |  6.21 M    |   5.03 / 152.80   |
| 200    | 200  |   2     |  0.35     | 0.50    |  6.21 M    |   5.03 / 152.37    |


| 200    | 200  |   6     |  0.2      | 0.25    |  7.50 M    |   5.00 / 148.95    |
| 700    | 700  |   4     |  0.2      | 0.25    | 35.13 M    |   4.79 / 120.40    |
| 1200   | 1200 |   3     |  0.2      | 0.25    | 67.87 M    |   4.80 / 121.22    |
| 2000   | 2000 |   2     |  0.2      | 0.25    |119.48 M    |   4.84 / 126.66    |



### data format 
emsize 1000 tied, layer 3, dropput 0.25, clip 0.2, parameters: 51.76M
| Batchsize | bptt  |  Loss / PPL        | 
| --------- | ----  | -----              |
| 10        | 20    | 4.80 / 121.32      |
| 10        | 35    | 4.78 / 118.95      |
| 10        | 50    | 4.78 / 118.56      |
| 20        | 20    | 4.79 / 120.48      |
| 20        | 35    | 4.78 / 118.95      |
| 20        | 50    | 4.78 / 118.87      |
| 30        | 20    | 4.79 / 120.01      |
| 30        | 35    | 4.78 / 118.85      |
| 30        | 50    | 4.78 / 118.96      |
| 40        | 20    | 4.79 / 120.25      |
| 40        | 35    | 4.80 / 121.23      |
| 40        | 50    | 4.80 / 121.00      |

### Re-research on Drop out with larger LR
400 - 1200 - 2 Untied 63.58M
| Dropout    |  Loss / PPL   | 
| 0.15       | 4.86 /129.30 |  
| 0.25       | 4.80 /121.67| 
| 0.35       | 4.76 /116.97| 
| 0.45       | 4.76 /116.27| 

1000 - 1000 - 3 tied 51.76M
| Dropout    |  Loss / PPL | 
| 0.15       | 4.81/122.83 | 
| 0.25       | 4.75/115.78 | 
| 0.35       | 4.73/112.94 | 
| 0.45       | 4.74/114.17 | 

### Best param finding now
- elevate lr to see whether to have some benefits : Make no big difference
- nlayers analysis : params increases performance
1100 tied lr=60 
| nlayers   | Params  | Loss / PPL     |
| -----     | ---     | ----           |
|   1       |  40.20  | 4.80 / 121.93  |
|   2       |  49.89  | 4.75 / 116.03  |
|   3       |  59.58  | 4.73 / 113.56  |


## Transformer


| emsize | nhid | tie   |nlayers | n-heads | drop out  | param_size  | Best loss/PPL    |
| ------ | ---- | ------- | --------- | ------- | ---------  |-------------     |
| 800   | 800   | True  | 2     | 8     | 0.4   | 52.8M     | 5.08 / 160.07 |
| 768   | 768   | True  | 12     | 12     | 0.3   | 63.87M    | 4.85 / 128.24 |
| 768   | 768   | True  | 12     | 12     | 0.4   | 63.87M    | 4.90 / 134.89 |
| 768   | 768   | True  | 12     | 12     | 0.5   | 63.87M    | 4.95 / 141.86 |
| 600   | 768   | False  | 12     | 12     | 0.3   | 61.69M    | 4.90 / 134.32 |
| 600   | 768   | False  | 12     | 12     | 0.4   | 61.69M    | 4.92 / 137.02 |
| 600   | 768   | False  | 12     | 12     | 0.5   | 61.69M    | 4.98 / 145.46 |


## GRU
| emsize | nhid | tie   |nlayers | clip | drop out  | param_size  | Best loss/PPL    |
| ------ | ---- | ------- | --------- | ------- | ---------  |-------------     |
| 1000  | 1000  |   True    |   3   | 0.25  |  0.35  | 45.76M   | 4.97 / 144.65 | # 第一次见 test loss 小于 train about 1
| 400   | 1200  |   False   |   2   | 0.25  |  0.45  | 58.78M   | 5.00 / 148.59 |
| 1100  | 1100  |   True    |   3   | 0.25  |  0.25  | 52.31M   | 4.80 / 121.41 | 
| 1100  | 1100  |   True    |   3   | 0.25  |  0.35  | 52.31M   | 4.96 / 142.24 |  ## 中间数值炸了
| 1100  | 1100  |   True    |   3   | 0.25  |  0.45  | 52.31M   | 4.80 / 121.28 | 
| 1100  | 1100  |   True    |   4   | 0.25  |  0.25  | 59.58M   | 前期数值炸了 | 
| 1100  | 1100  |   True    |   4   | 0.25  |  0.35  | 59.58M   | 前期数值炸了 |  
| 1100  | 1100  |   True    |   4   | 0.25  |  0.45  | 59.58M   | 4.84 / 127.01 | 


emsize == nhiden == 1300 (Tied), nlayers=3
| clip  |  lr   |  Loss / PPL   |
| ----  |  --   |  ----------   |
| 0.4   |   0.1 |  5.23/187.12  |
| 0.4   |   1.0 |  4.84/126.75  |
| 0.4   |   10  |  4.78/119.00  |
| 0.8   |   0.1 |  5.11/166.35  |
| 0.8   |   1.0 |  4.86/128.83  |
| 0.8   |   10  |  5.62/276.82  |



LSTM: 2022-04-16/02-39-28/2
Transformer: 2022-04-18/10-24-18/0
GRU: 2022-04-18/22-46-04/0